<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Generative Guitar Station</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 新增：雨滴 Canvas 样式，覆盖全屏但不阻挡点击 */
        #rain-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* 放在背景层 */
            pointer-events: none; /* 让鼠标事件穿透 */
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <!-- 新增 Canvas -->
    <canvas id="rain-canvas"></canvas>

    <div class="controls-top">
        <div class="control-group">
            <label>MODE / SCALE</label>
            <select id="scale-select">
                <!-- 动态生成 -->
            </select>
        </div>
        
        <!-- 新增：音色选择 -->
        <div class="control-group">
            <label>SOUND</label>
            <select id="instrument-select">
                <!-- JS填充 -->
            </select>
        </div>
        <div class="control-group">
            <label>TIME SIG</label>
            <select id="time-sig-select">
                <option value="4">4/4</option>
                <option value="3">3/4</option>
                <option value="6">6/8</option>
            </select>
        </div>
        <!-- 鼓组开关 -->
        <div class="control-group">
            <label>DRUMS</label>
            <input type="checkbox" id="drums-toggle">
        </div>
        <div class="control-group">
            <label>BPM: <span id="bpm-val">80</span></label>
            <input type="range" id="bpm-slider" min="40" max="160" value="80">
        </div>
    </div>
    <div class="controls-bottom">
        <!-- 雨声开关 -->
        <div class="control-group">
            <label>Rain Ambience</label>
            <label class="switch">
                <input type="checkbox" id="rain-toggle">
                <span class="slider round"></span>
            </label>
        </div>
        <!-- 新增：噪音控制面板 -->
        <div class="control-group" style="flex-direction: column; align-items: flex-start; gap: 10px; margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; width: 100%;">
            <label style="color: #888; font-size: 12px; margin-bottom: 5px;">AMBIENCE CONTROL</label>
            
            <!-- 音量 -->
            <div style="display: flex; width: 100%; justify-content: space-between; align-items: center;">
                <label style="font-size: 12px;">Rain Vol</label>
                <input type="range" id="noise-vol" min="0" max="1" step="0.01" value="0" style="width: 60%;">
            </div>

            <!-- 频率 (雨的大小/颜色) -->
            <div style="display: flex; width: 100%; justify-content: space-between; align-items: center;">
                <label style="font-size: 12px;">Tone</label>
                <input type="range" id="noise-freq" min="100" max="3000" step="10" value="400" style="width: 60%;">
            </div>

            <!-- Q值 (风声/共振) -->
            <div style="display: flex; width: 100%; justify-content: space-between; align-items: center;">
                <label style="font-size: 12px;">Wind</label>
                <input type="range" id="noise-q" min="0" max="20" step="0.1" value="0" style="width: 60%;">
            </div>
        </div>
    </div>

    <div class="display-area" id="main-ui">
        <div class="chord-box">
            <h3>CURRENT CHORD</h3>
            <h1 id="chord-display">--</h1>
            <div id="chord-detail">Waiting...</div>
        </div>
        <div class="chord-box">
            <h3>MELODY NOTE</h3>
            <h1 id="note-display">--</h1>
        </div>
    </div>

    <button id="start-btn">Start Session</button>
    
    <div id="log"></div>

    <!-- 引入 Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <!-- 按顺序加载脚本 -->
    <script src="js/data.js"></script>
    <script src="js/instruments.js"></script>
    <script src="js/synth.js"></script>

    <script src="js/noise_generator.js"></script>
    <script src="js/nextnote.js"></script>
    <!-- 新增：视觉脚本 -->
    <script src="js/visuals.js"></script> 
    <script src="js/app.js"></script>
    <script src="js/worker.js"></script>
</body>
</html>